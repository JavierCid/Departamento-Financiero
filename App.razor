@using Microsoft.AspNetCore.Components.Routing
@using Departamento_Financiero.Pages
@using Departamento_Financiero.Layout

@inject NavigationManager Nav
@implements IDisposable

@if (_currentPath == "/")
{
    <MainLayout>
        <Home />
    </MainLayout>
}
else if (_currentPath == "/upload-excel" || _currentPath == "/contrasteprinex")
{
    <MainLayout>
        <UploadExcel />
    </MainLayout>
}
else if (_currentPath == "/uploadexcel-contabilidad")
{
    <MainLayout>
        <UploadExcelContabilidad />
    </MainLayout>
}
else if (_currentPath == "/cuadrepdfprinex")
{
    <MainLayout>
        <Cuadrepdfprinex />
    </MainLayout>
}
else if (_currentPath == "/bankflowpro")
{
    <MainLayout>
        <BankFlowPro />
    </MainLayout>
}
else if (_currentPath == "/procesar-pdfs" || _currentPath == "/desglose-facturas")
{
    <MainLayout>
        <DesgloseFacturas />
    </MainLayout>
}
else
{
    <MainLayout>
        <div style="color:white; padding:16px;">
            <h3>No hay nada en esta dirección</h3>
            <p>@_currentPath</p>
        </div>
    </MainLayout>
}

@code {
    private string _currentPath = "/";

    protected override void OnInitialized()
    {
        ActualizarRuta(Nav.Uri);
        Nav.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        ActualizarRuta(e.Location);
        InvokeAsync(StateHasChanged);
    }

    private void ActualizarRuta(string uri)
    {
        var baseUri = Nav.BaseUri;

        if (uri.StartsWith(baseUri, StringComparison.OrdinalIgnoreCase))
        {
            _currentPath = "/" + uri.Substring(baseUri.Length).TrimStart('/');
        }
        else
        {
            _currentPath = "/";
        }

        if (string.IsNullOrWhiteSpace(_currentPath))
        {
            _currentPath = "/";
        }
    }

    public void Dispose()
    {
        Nav.LocationChanged -= OnLocationChanged;
    }
}
